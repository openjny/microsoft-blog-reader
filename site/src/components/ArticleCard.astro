---
import { type Article, stripHtml, formatBoard } from "../lib/db";
import { getBlogUrl, getArticleGroups, GROUP_COLORS } from "../lib/blogs";

interface Props {
  article: Article;
}

const { article } = Astro.props;
const description = stripHtml(article.description);
const truncatedDescription = description.length > 200 ? description.slice(0, 200) + "..." : description;
const blogUrl = getBlogUrl(article.board);
const groups = getArticleGroups(article.title, article.description, article.board);
---

<article class="bg-white rounded-lg shadow-sm border border-gray-200 p-5 hover:shadow-md transition-shadow">
  <!-- Header: タイトル -->
  <h2 class="text-lg font-semibold mb-3 leading-snug">
    <a
      href={article.link}
      class="text-gray-900 hover:text-blue-600 transition-colors"
      target="_blank"
      rel="noopener noreferrer"
    >
      {article.title}
    </a>
  </h2>

  <!-- Description -->
  {truncatedDescription && (
    <p class="text-gray-600 text-sm leading-relaxed mb-3">{truncatedDescription}</p>
  )}

  <!-- Meta: 日付・著者・ボード -->
  <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-gray-500">
    <span class="inline-flex items-center gap-1">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <time class="local-time" datetime={article.pub_date}>Loading...</time>
    </span>
    {article.author && (
      <span class="inline-flex items-center gap-1">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        <span>{article.author}</span>
      </span>
    )}
    {article.board && (
      blogUrl ? (
        <a
          href={blogUrl}
          class="text-blue-600 hover:text-blue-800 hover:underline text-xs font-medium transition-colors"
          target="_blank"
          rel="noopener noreferrer"
        >
          {formatBoard(article.board)}
        </a>
      ) : (
        <span class="text-gray-600 text-xs font-medium">
          {formatBoard(article.board)}
        </span>
      )
    )}
    {groups.map((group) => {
      const colors = GROUP_COLORS[group];
      return (
        <span class:list={[colors.bg, colors.text, "px-2 py-0.5 rounded text-xs font-medium"]}>
          {group}
        </span>
      );
    })}
  </div>
</article>
